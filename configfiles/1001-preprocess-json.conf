# SOF-ELKÂ® Configuration File
# (C)2021 Lewes Technology Consulting, LLC
#
# This file preprocesses JSON-formatted logs

filter {
  if "json" in [tags] {

    # in some cases, such as when an array of JSON objects has been de-wrapped we might get a trailing comma on an object
    # this will break the JSON handler, so remove it
    if [message] =~ "},$" {
      mutate {
        gsub => [ "message", "},$", "}" ]
      }
    }

    json {
      source => "message"
      target => "raw"
      remove_tag => [ "json" ]
      remove_field => [ "message" ]
    }
  }
}